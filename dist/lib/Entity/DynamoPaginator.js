"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.DynamoPaginator = void 0;
class DynamoPaginator {
    constructor({ method, opts, tableName, initializer, }) {
        this._items = [];
        this._dynamoMethod = method;
        this._opts = opts || {};
        this._tableName = tableName;
        this._initializer = initializer;
        this[method.name] = this.next;
    }
    get options() {
        return Object.assign(Object.assign({}, this._opts), { TableName: this._tableName, ExclusiveStartKey: this._startKey });
    }
    get lastPageItems() {
        return this._lastPageItems;
    }
    get items() {
        return this._items;
    }
    get morePages() {
        return (this._lastPageItems == null
            || (this._lastPageItems != null
                && this._startKey != null));
    }
    async next() {
        if (!this.morePages) {
            throw new Error('All pages were already scanned');
        }
        else {
            const { Items: items, LastEvaluatedKey: lastEvaluatedKey, } = await this._dynamoMethod.call(this, this.options);
            const instances = items.map((i) => this._initializer(i));
            this._lastPageItems = instances;
            this._items = this._items.concat(instances);
            this._startKey = lastEvaluatedKey;
            return this;
        }
    }
    async getAll() {
        while (this.morePages) {
            await this.next();
        }
        return this;
    }
}
exports.DynamoPaginator = DynamoPaginator;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiRHluYW1vUGFnaW5hdG9yLmpzIiwic291cmNlUm9vdCI6Ii8iLCJzb3VyY2VzIjpbImxpYi9FbnRpdHkvRHluYW1vUGFnaW5hdG9yLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7OztBQVVBLE1BQWEsZUFBZTtJQWUxQixZQUFZLEVBQ1YsTUFBTSxFQUFFLElBQUksRUFBRSxTQUFTLEVBQUUsV0FBVyxHQUNqQjtRQVpYLFdBQU0sR0FBVSxFQUFFLENBQUM7UUFhM0IsSUFBSSxDQUFDLGFBQWEsR0FBRyxNQUFNLENBQUM7UUFDNUIsSUFBSSxDQUFDLEtBQUssR0FBRyxJQUFJLElBQUksRUFBRSxDQUFDO1FBQ3hCLElBQUksQ0FBQyxVQUFVLEdBQUcsU0FBUyxDQUFDO1FBQzVCLElBQUksQ0FBQyxZQUFZLEdBQUcsV0FBVyxDQUFDO1FBRWhDLElBQUksQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLEdBQUcsSUFBSSxDQUFDLElBQUksQ0FBQztJQUNoQyxDQUFDO0lBRUQsSUFBYyxPQUFPO1FBQ25CLHVDQUNLLElBQUksQ0FBQyxLQUFLLEtBQ2IsU0FBUyxFQUFFLElBQUksQ0FBQyxVQUFVLEVBQzFCLGlCQUFpQixFQUFFLElBQUksQ0FBQyxTQUFTLElBQ2pDO0lBQ0osQ0FBQztJQUVELElBQUksYUFBYTtRQUNmLE9BQU8sSUFBSSxDQUFDLGNBQWMsQ0FBQztJQUM3QixDQUFDO0lBRUQsSUFBSSxLQUFLO1FBQ1AsT0FBTyxJQUFJLENBQUMsTUFBTSxDQUFDO0lBQ3JCLENBQUM7SUFFRCxJQUFJLFNBQVM7UUFDWCxPQUFPLENBQ0wsSUFBSSxDQUFDLGNBQWMsSUFBSSxJQUFJO2VBQ3hCLENBQ0QsSUFBSSxDQUFDLGNBQWMsSUFBSSxJQUFJO21CQUN4QixJQUFJLENBQUMsU0FBUyxJQUFJLElBQUksQ0FDMUIsQ0FDRixDQUFDO0lBQ0osQ0FBQztJQUVELEtBQUssQ0FBQyxJQUFJO1FBQ1IsSUFBSSxDQUFDLElBQUksQ0FBQyxTQUFTLEVBQUU7WUFDbkIsTUFBTSxJQUFJLEtBQUssQ0FBQyxnQ0FBZ0MsQ0FBQyxDQUFDO1NBQ25EO2FBQU07WUFDTCxNQUFNLEVBQ0osS0FBSyxFQUFFLEtBQUssRUFDWixnQkFBZ0IsRUFBRSxnQkFBZ0IsR0FDbkMsR0FBRyxNQUFNLElBQUksQ0FBQyxhQUFhLENBQUMsSUFBSSxDQUFDLElBQUksRUFBRSxJQUFJLENBQUMsT0FBTyxDQUFDLENBQUM7WUFFdEQsTUFBTSxTQUFTLEdBQUcsS0FBSyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsRUFBRSxFQUFFLENBQUMsSUFBSSxDQUFDLFlBQVksQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBRXpELElBQUksQ0FBQyxjQUFjLEdBQUcsU0FBUyxDQUFDO1lBQ2hDLElBQUksQ0FBQyxNQUFNLEdBQUcsSUFBSSxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsU0FBUyxDQUFDLENBQUM7WUFDNUMsSUFBSSxDQUFDLFNBQVMsR0FBRyxnQkFBZ0IsQ0FBQztZQUVsQyxPQUFPLElBQUksQ0FBQztTQUNiO0lBQ0gsQ0FBQztJQUVELEtBQUssQ0FBQyxNQUFNO1FBQ1YsT0FBTyxJQUFJLENBQUMsU0FBUyxFQUFFO1lBQ3JCLE1BQU0sSUFBSSxDQUFDLElBQUksRUFBRSxDQUFDO1NBQ25CO1FBRUQsT0FBTyxJQUFJLENBQUM7SUFDZCxDQUFDO0NBQ0Y7QUE5RUQsMENBOEVDIiwic291cmNlc0NvbnRlbnQiOlsiLyogZXNsaW50LWRpc2FibGUgbm8tYXdhaXQtaW4tbG9vcCAqL1xuaW1wb3J0IHsgS2V5IH0gZnJvbSAnYXdzLXNkay9jbGllbnRzL2R5bmFtb2RiJztcblxudHlwZSBDb25zdHJ1Y3Rvck9wdGlvbnMgPSB7XG4gIG1ldGhvZDogRnVuY3Rpb247XG4gIG9wdHM/OiBvYmplY3Q7XG4gIHRhYmxlTmFtZTogc3RyaW5nO1xuICBpbml0aWFsaXplcjogKGl0ZW06IFJlY29yZDxzdHJpbmcsIGFueT4pID0+IGFueTtcbn07XG5cbmV4cG9ydCBjbGFzcyBEeW5hbW9QYWdpbmF0b3Ige1xuICBwcm90ZWN0ZWQgX2R5bmFtb01ldGhvZDogRnVuY3Rpb247XG5cbiAgcHJvdGVjdGVkIF9vcHRzOiBvYmplY3Q7XG5cbiAgcHJvdGVjdGVkIF9pdGVtczogYW55W10gPSBbXTtcblxuICBwcm90ZWN0ZWQgX2xhc3RQYWdlSXRlbXM6IGFueVtdO1xuXG4gIHByb3RlY3RlZCBfc3RhcnRLZXk6IEtleTtcblxuICBwcm90ZWN0ZWQgX3RhYmxlTmFtZTogc3RyaW5nO1xuXG4gIHByb3RlY3RlZCBfaW5pdGlhbGl6ZXI6IChpdGVtOiBSZWNvcmQ8c3RyaW5nLCBhbnk+KSA9PiBhbnk7XG5cbiAgY29uc3RydWN0b3Ioe1xuICAgIG1ldGhvZCwgb3B0cywgdGFibGVOYW1lLCBpbml0aWFsaXplcixcbiAgfTogQ29uc3RydWN0b3JPcHRpb25zKSB7XG4gICAgdGhpcy5fZHluYW1vTWV0aG9kID0gbWV0aG9kO1xuICAgIHRoaXMuX29wdHMgPSBvcHRzIHx8IHt9O1xuICAgIHRoaXMuX3RhYmxlTmFtZSA9IHRhYmxlTmFtZTtcbiAgICB0aGlzLl9pbml0aWFsaXplciA9IGluaXRpYWxpemVyO1xuXG4gICAgdGhpc1ttZXRob2QubmFtZV0gPSB0aGlzLm5leHQ7XG4gIH1cblxuICBwcm90ZWN0ZWQgZ2V0IG9wdGlvbnMoKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIC4uLnRoaXMuX29wdHMsXG4gICAgICBUYWJsZU5hbWU6IHRoaXMuX3RhYmxlTmFtZSxcbiAgICAgIEV4Y2x1c2l2ZVN0YXJ0S2V5OiB0aGlzLl9zdGFydEtleSxcbiAgICB9O1xuICB9XG5cbiAgZ2V0IGxhc3RQYWdlSXRlbXMoKSB7XG4gICAgcmV0dXJuIHRoaXMuX2xhc3RQYWdlSXRlbXM7XG4gIH1cblxuICBnZXQgaXRlbXMoKSB7XG4gICAgcmV0dXJuIHRoaXMuX2l0ZW1zO1xuICB9XG5cbiAgZ2V0IG1vcmVQYWdlcygpOiBib29sZWFuIHtcbiAgICByZXR1cm4gKFxuICAgICAgdGhpcy5fbGFzdFBhZ2VJdGVtcyA9PSBudWxsXG4gICAgICB8fCAoXG4gICAgICAgIHRoaXMuX2xhc3RQYWdlSXRlbXMgIT0gbnVsbFxuICAgICAgICAmJiB0aGlzLl9zdGFydEtleSAhPSBudWxsXG4gICAgICApXG4gICAgKTtcbiAgfVxuXG4gIGFzeW5jIG5leHQoKSB7XG4gICAgaWYgKCF0aGlzLm1vcmVQYWdlcykge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdBbGwgcGFnZXMgd2VyZSBhbHJlYWR5IHNjYW5uZWQnKTtcbiAgICB9IGVsc2Uge1xuICAgICAgY29uc3Qge1xuICAgICAgICBJdGVtczogaXRlbXMsXG4gICAgICAgIExhc3RFdmFsdWF0ZWRLZXk6IGxhc3RFdmFsdWF0ZWRLZXksXG4gICAgICB9ID0gYXdhaXQgdGhpcy5fZHluYW1vTWV0aG9kLmNhbGwodGhpcywgdGhpcy5vcHRpb25zKTtcblxuICAgICAgY29uc3QgaW5zdGFuY2VzID0gaXRlbXMubWFwKChpKSA9PiB0aGlzLl9pbml0aWFsaXplcihpKSk7XG5cbiAgICAgIHRoaXMuX2xhc3RQYWdlSXRlbXMgPSBpbnN0YW5jZXM7XG4gICAgICB0aGlzLl9pdGVtcyA9IHRoaXMuX2l0ZW1zLmNvbmNhdChpbnN0YW5jZXMpO1xuICAgICAgdGhpcy5fc3RhcnRLZXkgPSBsYXN0RXZhbHVhdGVkS2V5O1xuXG4gICAgICByZXR1cm4gdGhpcztcbiAgICB9XG4gIH1cblxuICBhc3luYyBnZXRBbGwoKSB7XG4gICAgd2hpbGUgKHRoaXMubW9yZVBhZ2VzKSB7XG4gICAgICBhd2FpdCB0aGlzLm5leHQoKTtcbiAgICB9XG5cbiAgICByZXR1cm4gdGhpcztcbiAgfVxufVxuIl19