"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.DynamoPaginator = void 0;
class DynamoPaginator {
    constructor({ method, opts, tableName, initializer, }) {
        this._items = [];
        this._dynamoMethod = method;
        this._opts = opts || {};
        this._tableName = tableName;
        this._initializer = initializer;
        this[method.name] = this.next;
    }
    get options() {
        return Object.assign(Object.assign({}, this._opts), { TableName: this._tableName, ExclusiveStartKey: this._startKey });
    }
    get lastPageItems() {
        return this._lastPageItems.map((i) => this._initializer(i));
    }
    get items() {
        return this._items.map((i) => this._initializer(i));
    }
    get morePages() {
        return (this._lastPageItems == null
            || (this._lastPageItems != null
                && this._startKey != null));
    }
    async next() {
        if (!this.morePages) {
            throw new Error('All pages were already scanned');
        }
        else {
            const { Items: items, LastEvaluatedKey: lastEvaluatedKey, } = await this._dynamoMethod.call(this, this.options);
            this._lastPageItems = items;
            this._items = this._items.concat(items);
            this._startKey = lastEvaluatedKey;
            return this;
        }
    }
    async getAll() {
        while (this.morePages) {
            await this.next();
        }
        return this;
    }
}
exports.DynamoPaginator = DynamoPaginator;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiRHluYW1vUGFnaW5hdG9yLmpzIiwic291cmNlUm9vdCI6Ii8iLCJzb3VyY2VzIjpbImxpYi9jbGFzc2VzL0R5bmFtb1BhZ2luYXRvci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7QUFVQSxNQUFhLGVBQWU7SUFlMUIsWUFBWSxFQUNWLE1BQU0sRUFBRSxJQUFJLEVBQUUsU0FBUyxFQUFFLFdBQVcsR0FDakI7UUFaWCxXQUFNLEdBQVUsRUFBRSxDQUFDO1FBYTNCLElBQUksQ0FBQyxhQUFhLEdBQUcsTUFBTSxDQUFDO1FBQzVCLElBQUksQ0FBQyxLQUFLLEdBQUcsSUFBSSxJQUFJLEVBQUUsQ0FBQztRQUN4QixJQUFJLENBQUMsVUFBVSxHQUFHLFNBQVMsQ0FBQztRQUM1QixJQUFJLENBQUMsWUFBWSxHQUFHLFdBQVcsQ0FBQztRQUVoQyxJQUFJLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxHQUFHLElBQUksQ0FBQyxJQUFJLENBQUM7SUFDaEMsQ0FBQztJQUVELElBQWMsT0FBTztRQUNuQix1Q0FDSyxJQUFJLENBQUMsS0FBSyxLQUNiLFNBQVMsRUFBRSxJQUFJLENBQUMsVUFBVSxFQUMxQixpQkFBaUIsRUFBRSxJQUFJLENBQUMsU0FBUyxJQUNqQztJQUNKLENBQUM7SUFFRCxJQUFJLGFBQWE7UUFDZixPQUFPLElBQUksQ0FBQyxjQUFjLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxJQUFJLENBQUMsWUFBWSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7SUFDOUQsQ0FBQztJQUVELElBQUksS0FBSztRQUNQLE9BQU8sSUFBSSxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLEVBQUUsRUFBRSxDQUFDLElBQUksQ0FBQyxZQUFZLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztJQUN0RCxDQUFDO0lBRUQsSUFBSSxTQUFTO1FBQ1gsT0FBTyxDQUNMLElBQUksQ0FBQyxjQUFjLElBQUksSUFBSTtlQUN4QixDQUNELElBQUksQ0FBQyxjQUFjLElBQUksSUFBSTttQkFDeEIsSUFBSSxDQUFDLFNBQVMsSUFBSSxJQUFJLENBQzFCLENBQ0YsQ0FBQztJQUNKLENBQUM7SUFFRCxLQUFLLENBQUMsSUFBSTtRQUNSLElBQUksQ0FBQyxJQUFJLENBQUMsU0FBUyxFQUFFO1lBQ25CLE1BQU0sSUFBSSxLQUFLLENBQUMsZ0NBQWdDLENBQUMsQ0FBQztTQUNuRDthQUFNO1lBQ0wsTUFBTSxFQUNKLEtBQUssRUFBRSxLQUFLLEVBQ1osZ0JBQWdCLEVBQUUsZ0JBQWdCLEdBQ25DLEdBQUcsTUFBTSxJQUFJLENBQUMsYUFBYSxDQUFDLElBQUksQ0FBQyxJQUFJLEVBQUUsSUFBSSxDQUFDLE9BQU8sQ0FBQyxDQUFDO1lBRXRELElBQUksQ0FBQyxjQUFjLEdBQUcsS0FBSyxDQUFDO1lBQzVCLElBQUksQ0FBQyxNQUFNLEdBQUcsSUFBSSxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLENBQUM7WUFDeEMsSUFBSSxDQUFDLFNBQVMsR0FBRyxnQkFBZ0IsQ0FBQztZQUVsQyxPQUFPLElBQUksQ0FBQztTQUNiO0lBQ0gsQ0FBQztJQUVELEtBQUssQ0FBQyxNQUFNO1FBQ1YsT0FBTyxJQUFJLENBQUMsU0FBUyxFQUFFO1lBQ3JCLE1BQU0sSUFBSSxDQUFDLElBQUksRUFBRSxDQUFDO1NBQ25CO1FBRUQsT0FBTyxJQUFJLENBQUM7SUFDZCxDQUFDO0NBQ0Y7QUE1RUQsMENBNEVDIiwic291cmNlc0NvbnRlbnQiOlsiLyogZXNsaW50LWRpc2FibGUgbm8tYXdhaXQtaW4tbG9vcCAqL1xuaW1wb3J0IHsgS2V5IH0gZnJvbSAnYXdzLXNkay9jbGllbnRzL2R5bmFtb2RiJztcblxudHlwZSBDb25zdHJ1Y3Rvck9wdGlvbnMgPSB7XG4gIG1ldGhvZDogRnVuY3Rpb247XG4gIG9wdHM/OiBvYmplY3Q7XG4gIHRhYmxlTmFtZTogc3RyaW5nO1xuICBpbml0aWFsaXplcjogKGl0ZW06IFJlY29yZDxzdHJpbmcsIGFueT4pID0+IGFueTtcbn07XG5cbmV4cG9ydCBjbGFzcyBEeW5hbW9QYWdpbmF0b3Ige1xuICBwcm90ZWN0ZWQgX2R5bmFtb01ldGhvZDogRnVuY3Rpb247XG5cbiAgcHJvdGVjdGVkIF9vcHRzOiBvYmplY3Q7XG5cbiAgcHJvdGVjdGVkIF9pdGVtczogYW55W10gPSBbXTtcblxuICBwcm90ZWN0ZWQgX2xhc3RQYWdlSXRlbXM6IGFueVtdO1xuXG4gIHByb3RlY3RlZCBfc3RhcnRLZXk6IEtleTtcblxuICBwcm90ZWN0ZWQgX3RhYmxlTmFtZTogc3RyaW5nO1xuXG4gIHByb3RlY3RlZCBfaW5pdGlhbGl6ZXI6IChpdGVtOiBSZWNvcmQ8c3RyaW5nLCBhbnk+KSA9PiBhbnk7XG5cbiAgY29uc3RydWN0b3Ioe1xuICAgIG1ldGhvZCwgb3B0cywgdGFibGVOYW1lLCBpbml0aWFsaXplcixcbiAgfTogQ29uc3RydWN0b3JPcHRpb25zKSB7XG4gICAgdGhpcy5fZHluYW1vTWV0aG9kID0gbWV0aG9kO1xuICAgIHRoaXMuX29wdHMgPSBvcHRzIHx8IHt9O1xuICAgIHRoaXMuX3RhYmxlTmFtZSA9IHRhYmxlTmFtZTtcbiAgICB0aGlzLl9pbml0aWFsaXplciA9IGluaXRpYWxpemVyO1xuXG4gICAgdGhpc1ttZXRob2QubmFtZV0gPSB0aGlzLm5leHQ7XG4gIH1cblxuICBwcm90ZWN0ZWQgZ2V0IG9wdGlvbnMoKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIC4uLnRoaXMuX29wdHMsXG4gICAgICBUYWJsZU5hbWU6IHRoaXMuX3RhYmxlTmFtZSxcbiAgICAgIEV4Y2x1c2l2ZVN0YXJ0S2V5OiB0aGlzLl9zdGFydEtleSxcbiAgICB9O1xuICB9XG5cbiAgZ2V0IGxhc3RQYWdlSXRlbXMoKSB7XG4gICAgcmV0dXJuIHRoaXMuX2xhc3RQYWdlSXRlbXMubWFwKChpKSA9PiB0aGlzLl9pbml0aWFsaXplcihpKSk7XG4gIH1cblxuICBnZXQgaXRlbXMoKSB7XG4gICAgcmV0dXJuIHRoaXMuX2l0ZW1zLm1hcCgoaSkgPT4gdGhpcy5faW5pdGlhbGl6ZXIoaSkpO1xuICB9XG5cbiAgZ2V0IG1vcmVQYWdlcygpOiBib29sZWFuIHtcbiAgICByZXR1cm4gKFxuICAgICAgdGhpcy5fbGFzdFBhZ2VJdGVtcyA9PSBudWxsXG4gICAgICB8fCAoXG4gICAgICAgIHRoaXMuX2xhc3RQYWdlSXRlbXMgIT0gbnVsbFxuICAgICAgICAmJiB0aGlzLl9zdGFydEtleSAhPSBudWxsXG4gICAgICApXG4gICAgKTtcbiAgfVxuXG4gIGFzeW5jIG5leHQoKSB7XG4gICAgaWYgKCF0aGlzLm1vcmVQYWdlcykge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdBbGwgcGFnZXMgd2VyZSBhbHJlYWR5IHNjYW5uZWQnKTtcbiAgICB9IGVsc2Uge1xuICAgICAgY29uc3Qge1xuICAgICAgICBJdGVtczogaXRlbXMsXG4gICAgICAgIExhc3RFdmFsdWF0ZWRLZXk6IGxhc3RFdmFsdWF0ZWRLZXksXG4gICAgICB9ID0gYXdhaXQgdGhpcy5fZHluYW1vTWV0aG9kLmNhbGwodGhpcywgdGhpcy5vcHRpb25zKTtcblxuICAgICAgdGhpcy5fbGFzdFBhZ2VJdGVtcyA9IGl0ZW1zO1xuICAgICAgdGhpcy5faXRlbXMgPSB0aGlzLl9pdGVtcy5jb25jYXQoaXRlbXMpO1xuICAgICAgdGhpcy5fc3RhcnRLZXkgPSBsYXN0RXZhbHVhdGVkS2V5O1xuXG4gICAgICByZXR1cm4gdGhpcztcbiAgICB9XG4gIH1cblxuICBhc3luYyBnZXRBbGwoKSB7XG4gICAgd2hpbGUgKHRoaXMubW9yZVBhZ2VzKSB7XG4gICAgICBhd2FpdCB0aGlzLm5leHQoKTtcbiAgICB9XG5cbiAgICByZXR1cm4gdGhpcztcbiAgfVxufVxuIl19